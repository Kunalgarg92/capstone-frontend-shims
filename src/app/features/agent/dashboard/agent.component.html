<div class="agent-container">
  <!-- Success/Error Alerts -->
  <div *ngIf="message.text" class="alert" [ngClass]="message.type">
    {{ message.text }}
  </div>

  <div class="dashboard-header">
    <div class="header-left">
      <h1>ğŸ‘¥ Customer Management Dashboard</h1>
      <p>Manage policies and enroll customers in health plans</p>
    </div>
    <div class="header-stats">
      <div class="stat-card">
        <span class="stat-number">{{ customers().length }}</span>
        <span class="stat-label">Active Customers</span>
      </div>
      <div class="stat-card">
        <span class="stat-number">{{ userPolicies.length }}</span>
        <span class="stat-label">Total Policies</span>
      </div>
    </div>
  </div>

  <div class="dashboard-layout">
    <!-- LEFT: Professional Customer Selector -->
    <div class="customer-panel">
      <div class="panel-header">
        <h3>ğŸ“‹ Select Customer</h3>
        <span class="customer-count">{{ customers().length }} customers</span>
      </div>

      <div class="search-box">
        <input
          type="text"
          placeholder="ğŸ” Search customers..."
          [(ngModel)]="searchTerm"
          (input)="filterCustomers()"
          class="search-input"
        />
      </div>

      <!-- Scrollable Customer List -->
      <div class="customer-list">
        <div
          *ngFor="let c of filteredCustomers()"
          class="customer-item"
          [class.active]="selectedCustomer?.id === c.id"
          (click)="selectCustomer(c)"
        >
          <div class="customer-avatar">{{ getInitials(c.email) }}</div>
          <div class="customer-info">
            <div class="customer-name">{{ c.email }}</div>
            <div class="customer-id">ID: {{ c.id }}</div>
          </div>
          <div class="customer-status">
            <span class="status-dot active"></span>
            <span class="status-text">Active</span>
          </div>
        </div>

        <!-- Loading Skeleton -->
        <div *ngIf="isLoadingCustomers" class="skeleton-list">
          <div class="skeleton-item"></div>
          <div class="skeleton-item"></div>
          <div class="skeleton-item"></div>
        </div>
      </div>
    </div>

    <!-- RIGHT: Main Content -->
    <div class="main-content">
      <!-- LOADING SCREEN - Professional -->
      <div *ngIf="!selectedCustomer && !isLoadingCustomers" class="welcome-screen">
        <div class="welcome-icon">ğŸš€</div>
        <h2>Welcome to Customer Dashboard</h2>
        <p>Select a customer from the left panel to view their policies and available plans</p>
        <div class="quick-actions">
          <button class="btn-quick" (click)="loadSampleCustomer()">ğŸ‘¤ Load Sample Customer</button>
        </div>
      </div>

      <!-- Customer Selected Content -->
      <div *ngIf="selectedCustomer">
        <!-- Policies Section -->
        <section class="policy-section">
          <div class="section-header">
            <h2>ğŸ“„ Active Policies for {{ selectedCustomer.email }}</h2>
            <span class="section-badge">{{ userPolicies.length }} Policies</span>
          </div>

          <div class="policy-grid" *ngIf="userPolicies.length > 0; else noPolicies">
            <div
              *ngFor="let pol of userPolicies"
              class="policy-card"
              [ngClass]="pol.status?.toLowerCase()"
            >
              <div class="policy-header">
                <div class="policy-badge" [ngClass]="pol.status?.toLowerCase()">
                  {{ pol.status }}
                </div>
                <div class="policy-icon">ğŸ›¡ï¸</div>
              </div>

              <div class="policy-details">
                <h3>{{ pol.plan?.name || 'Health Plan' }}</h3>
                <div class="policy-meta">
                  <span class="meta-item">
                    <strong>Start:</strong> {{ pol.startDate | date : 'short' }}
                  </span>
                  <span class="meta-item">
                    <strong>End:</strong> {{ pol.endDate | date : 'short' }}
                  </span>
                  <span class="meta-item coverage">
                    Coverage: â‚¹{{ pol.plan?.coverageLimit | number }}
                  </span>
                </div>
              </div>

              <div class="policy-actions">
                <button
                  *ngIf="pol.status === 'ACTIVE'"
                  class="btn-action btn-suspend"
                  (click)="suspend(pol)"
                >
                  â¸ï¸ Suspend
                </button>

                <button
                  *ngIf="pol.status === 'EXPIRED'"
                  class="btn-action btn-renew"
                  (click)="renew(pol)"
                >
                  ğŸ”„ Renew Now
                </button>

                <div *ngIf="pol.status === 'SUSPENDED'" class="status-warning">
                  <span>âš ï¸ Cannot renew while suspended</span>
                </div>
              </div>
            </div>
          </div>

          <ng-template #noPolicies>
            <div class="empty-state">
              <div class="empty-icon">ğŸ“­</div>
              <p>No policies found for this customer</p>
            </div>
          </ng-template>
        </section>

        <!-- Available Plans Section -->
        <section class="plans-section">
          <div class="section-header">
            <h2>ğŸ›’ Available Plans</h2>
          </div>

          <div class="plan-grid">
            <div *ngFor="let p of plans" class="plan-card">
              <div class="plan-header">
                <h3>{{ p.name }}</h3>
                <span class="plan-badge">New</span>
              </div>
              <div class="plan-price">
                <div class="price">â‚¹{{ p.premiumAmount | number }}/year</div>
                <div class="coverage">Coverage up to â‚¹{{ p.coverageLimit | number }}</div>
              </div>

              <button
                *ngIf="!isAlreadyEnrolled(p.id)"
                class="btn-primary btn-enroll"
                (click)="enroll(p.id)"
              >
                Enroll Customer
              </button>
              <button *ngIf="isAlreadyEnrolled(p.id)" class="btn-secondary" disabled>
                âœ… Already Enrolled
              </button>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
</div>
